<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta content="webkit|ie-comp|ie-stand" name="renderer">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
		<meta content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
		<meta content="no-siteapp" http-equiv="Cache-Control" />
		<link rel="Shortcut Icon" href="__PUBLIC__/favicon.ico" />
		<!--[if lt IE 9]>
    			<script type="text/javascript" src="__PUBLIC__/static/H-ui.admin/lib/html5shiv.js"></script>
    			<script type="text/javascript" src="__PUBLIC__/static/H-ui.admin/lib/respond.min.js"></script>
  		<![endif]-->
		<link href="__PUBLIC__/static/H-ui.admin/static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/static/H-ui.admin/static/h-ui.admin/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/static/H-ui.admin/lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/static/H-ui.admin/static/h-ui.admin/skin/default/skin.css" id="skin" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/static/H-ui.admin/static/h-ui.admin/css/style.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/static/plugins/bootstrap-table/css/bootstrap.min.css" rel="stylesheet">
		<link href="__PUBLIC__/static/plugins/bootstrap-table/css/bootstrap-table.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/plugins/gooflow0.8/css/GooFlow2.css" />
		<!--<link rel="stylesheet" type="text/css" href="__PUBLIC__/static/plugins/gooflow0.8/css/default.css"/>-->
		<!--[if IE 6]>
    			<script type="text/javascript" src="__PUBLIC__/static/H-ui.admin/lib/DD_belatedPNG_0.0.8a-min.js" ></script>
    			<script>DD_belatedPNG.fix('*');</script>
  		<![endif]-->
		<title>
			冒烟用例：{$nodeName}
		</title>
	</head>

	<body>

		<div class="page-container">
			<div class="cl pd-5" id="toolbar" style="background-color: #C81623;">
				<table>
					<tr align="left">
						<td>
							<span class="l">
								<a style="color: #fff; font-size: 16px;">冒烟用例：{$nodeName}  </a>
                    			<a class="btn btn-danger radius" href="javascript:;" onclick="runForm()"><i class="Hui-iconfont">&#xe6a7;</i> 执行用例</a>
                			</span>
						</td>
						<td width="180px">
							<input type="text" id="operator" name="operator" placeholder="操作人" value="" class="input-text">
						</td>
					</tr>
				</table>
			</div>
			<div id="divtb">
				<table id="table"></table>
			</div>
		</div>
		<div id="divform" style="display: none;">
			<form class="form form-horizontal" id="form-tc">
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>用例名称：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" id="tcName" name="tcName" placeholder="控制在30个字、60个字节以内" value="" class="input-text">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-2">前提条件：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<textarea id="perDescript" name="perDescript" class="textarea"></textarea>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>操作步骤：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<textarea id="stepDescript" name="stepDescript" class="textarea"></textarea>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>预期结果：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<textarea id="expectDescript" name="expectDescript" class="textarea"></textarea>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-2">测试数据：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<textarea id="dataDescript" name="dataDescript" class="textarea"></textarea>
					</div>
				</div>
			</form>
			<div class="row cl">
				<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2" align="right" style="display: none;" id="runButton">
					<button id="failButton" onClick="runResult(1);" class="btn btn-danger radius" type="button"><i class="Hui-iconfont">&#xe6a6;</i> 执 行 失 败</button>
					<button id="passButton" onClick="runResult(2);" class="btn btn-success radius" type="button"><i class="Hui-iconfont">&#xe6a7;</i> 执 行 通 过</button>
					<button onClick="tcUp();" class="btn btn-primary radius" type="button"><i class="Hui-iconfont">&#xe679;</i> 上一条</button>
					<button onClick="tcNext();" class="btn btn-primary radius" type="button"><i class="Hui-iconfont">&#xe674;</i> 下一条</button>
					<button onClick="closeForm();" class="btn btn-warning radius" type="button"><i class="Hui-iconfont">&#xe678;</i> 返回</button>
				</div>
			</div>
		</div>
		<script src="__PUBLIC__/static/H-ui.admin/lib/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
		<script src="__PUBLIC__/static/H-ui.admin/lib/layer/2.4/layer.js" type="text/javascript"></script>
		<script src="__PUBLIC__/static/H-ui.admin/static/h-ui/js/H-ui.js" type="text/javascript"></script>
		<script src="__PUBLIC__/static/H-ui.admin/static/h-ui.admin/js/H-ui.admin.js" type="text/javascript"></script>
		<script src="__PUBLIC__/static/plugins/bootstrap-treeview/js/bootstrap-treeview.js"></script>
		<script type="text/javascript" src="__PUBLIC__/static/plugins/gooflow0.8/js/data.js"></script>
		<script type="text/javascript" src="__PUBLIC__/static/plugins/gooflow0.8/js/GooFunc.js"></script>
		<script type="text/javascript" src="__PUBLIC__/static/plugins/gooflow0.8/js/GooFlow.js"></script>
		<script type="text/javascript" src="__PUBLIC__/static/plugins/content-menu/js/BootstrapMenu.min.js"></script>
		<script src="__PUBLIC__/static/plugins/bootstrap-table/js/bootstrap.js"></script>

		<script type="text/javascript" src="__PUBLIC__/static/H-ui.admin/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
		<script type="text/javascript" src="__PUBLIC__/static/H-ui.admin/lib/jquery.validation/1.14.0/validate-methods.js"></script>
		<script type="text/javascript" src="__PUBLIC__/static/H-ui.admin/lib/jquery.validation/1.14.0/messages_zh.js"></script>
		<script type="text/javascript" src="__PUBLIC__/js/jquery-form.js"></script>
		<script src="__PUBLIC__/static/plugins/bootstrap-table/js/bootstrap-table.min.js"></script>
		<script src="__PUBLIC__/static/plugins/bootstrap-table/js/bootstrap-table-zh-CN.js"></script>
		</script>
		<script type="text/javascript">
			var operator = '';
			var currentTCId = 0;
			//显示执行用例页面
			function runForm() {
				operator = $('#operator').val().trim();
				if(operator.length == 0) {
					layer.msg("请填写页面右上角的操作人姓名（您的姓名）！", function() {});
					return;
				}
				var id = $.map($table.bootstrapTable('getSelections'), function(row) {
					return row.id;
				});
				if((id == 0) || (id == null)) {
					layer.msg("请勾选需要执行的用例！", function() {});
				} else {
					currentTCId = id.toString();
					$('#divtb').hide(300);
					$('#divform').show();
					$('#runButton').show();
					loadTCInfo4Runing();
				}
			}

			//执行用例
			function runResult(flag) {
				var usrData = {
					'tcId': currentTCId,
					'resultFlag': flag,
					'operator':operator
				};
				$.ajax({
					data: usrData,
					url: "__TestCaseURL__/testcase_management/runTestCase",
					type: "post",
					success: function(data) {
						if(data.status == 1) {
							refreshTableData();
							layer.msg('已完成用例执行。', {
								icon: 1,
								time: 1000
							});

						} else {
							layer.msg(data.info, function() {});
						}
					}
				});
			}

			//刷新表格数据
			function refreshTableData() {
				$table.bootstrapTable('refresh');
			}

			//加载测试用例信息(为用例执行提供的方法)
			var upTCId = 0;
			var nextTCId = 0;

			function loadTCInfo4Runing() {
				var usrData = {
					'tcId': currentTCId,
					'nodeId': '{$nodeId}'
				};
				$.ajax({
					data: usrData,
					url: "__TestCaseURL__/testcase_management/getTestCaseInfo",
					type: "post",
					success: function(data) {
						var tcData = $.parseJSON(data);
						$('#tcName').val(tcData['tc_name']);
						$('#perDescript').val(tcData['per_descript']);
						$('#stepDescript').val(tcData['step_descript']);
						$('#expectDescript').val(tcData['expect_descript']);
						$('#dataDescript').val(tcData['data_descript']);
						$('#passButton').show();
						$('#failButton').show();
						upTCId = tcData['upTCId'];
						nextTCId = tcData['nextTCId'];
						if(tcData['test_result'] == '1') {
							$('#failButton').hide();
						}
						if(tcData['test_result'] == '2') {
							$('#passButton').hide();
						}
					}
				});
			}

			$(function() {
				$table = $('#table').bootstrapTable("destroy").bootstrapTable({
					url: '__TestCaseURL__/testcase_management/getTestCase?nodeId={$nodeId}',
					method: 'get',
					cache: false,
					height: document.body.clientHeight - 60,
					striped: true,
					pagination: true,
					singleSelect: true,
					pageSize: 20,
					pageNumber: 1,
					pageList: [20, 40, 80, 120, 'All'],
					search: false,
					sidePagination: 'server',
					clickToSelect: true,
					columns: [{
						checkbox: true,
						align: 'center',
						width: 5
					}, {
						field: 'id',
						title: '用例ID',
						width: 70
					}, {
						field: 'tc_name',
						title: '用例名称'
					}, {
						field: 'review_status',
						title: '评审状态',
						align: 'center',
						width: 80,
						formatter: showStatus,
						visible: false
					}, {
						field: 'test_result',
						title: '测试结果',
						align: 'center',
						formatter: showResult,
						width: 80
					}, {
						field: 'creator_name',
						align: 'center',
						title: '创建人',
						width: 80
					}, {
						field: 'operator_name',
						align: 'center',
						title: '执行人',
						width: 80
					}, {
						field: 'create_date',
						title: '创建时间',
						align: 'center',
						width: 160
					}//, 
					//{
					//	field: 'do',
					//	align: 'center',
					//	title: '操作',
					//	width: 80,
					//	formatter: operate
					//}
				]
				});
			});

			//操作
			function operate(value, row, index) {
				return '<a style="color:red;" onclick="showForm(' + row.id + ')" >查看详情</a>';
			}

			//显示用例详情信息
			function showForm(id) {
				$('#divtb').hide(300);
				$('#divform').show();
				$.ajax({
					data: {
						'tcId': id
					},
					url: "__TestCaseURL__/share_management/getTestCaseInfo",
					type: "post",
					success: function(data) {
						var tcData = $.parseJSON(data);
						$('#tcName').val(tcData['tc_name']);
						$('#perDescript').val(tcData['per_descript']);
						$('#stepDescript').val(tcData['step_descript']);
						$('#expectDescript').val(tcData['expect_descript']);
						$('#dataDescript').val(tcData['data_descript']);
					}
				});
			}

			//显示用例评审状态
			function showStatus(value, row, index) {
				if(row.review_status == 0) {
					return '<a style="color:red;text-decoration:none">待评审</a>';
				} else if(row.review_status == 2) {
					return '<a style="color:green;text-decoration:none">已评审</a>';
				}
			}

			//显示用例评审状态
			function showResult(value, row, index) {
				if(row.test_result == 0) {
					return '<a style="color:#996600;text-decoration:none">未测试</a>';
				} else if(row.test_result == 1) {
					return '<a style="color:red;text-decoration:none">测试失败</a>';
				} else if(row.test_result == 2) {
					return '<a style="color:green;text-decoration:none">测试通过</a>';
				}
			}

			//关闭用例详情区域
			function closeForm() {
				$('#divtb').show();
				$('#divform').hide(300);
			}

			//清空测试用例表单控件文本
			function clearTCForm() {
				$('#tcName').val('');
				$('#perDescript').val('');
				$('#stepDescript').val('');
				$('#expectDescript').val('');
				$('#dataDescript').val('');
			}

			//上一条用例
			function tcUp() {
				if(upTCId == null || upTCId == 'null' || upTCId == '') {
					layer.msg("已经到顶了！", function() {});
					$('#upButton').hide(500);
				} else {
					currentTCId = upTCId;
					loadTCInfo4Runing();
				}
			}

			//下一条用例
			function tcNext() {
				if(nextTCId == null || nextTCId == 'null' || nextTCId == '') {
					layer.msg("已经到底了！", function() {});
					$('#nextButton').hide(500);
				} else {
					currentTCId = nextTCId;
					loadTCInfo4Runing();
				}
			}
		</script>
	</body>

</html>